<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. python语言基础语法 &mdash; Python入门 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Python入门 1.0.0 documentation" href="index.html" />
    <link rel="next" title="4. python常见应用" href="chapter4.html" />
    <link rel="prev" title="2. python环境搭建" href="chapter2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="chapter4.html" title="4. python常见应用"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="chapter2.html" title="2. python环境搭建"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Python入门 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. python语言基础语法</a><ul>
<li><a class="reference internal" href="#id1">3.1. 内置数据类型</a><ul>
<li><a class="reference internal" href="#numbers">3.1.1. numbers(数字)</a></li>
<li><a class="reference internal" href="#string">3.1.2. string(字符串)</a></li>
<li><a class="reference internal" href="#list">3.1.3. list(数组)</a></li>
<li><a class="reference internal" href="#tuple">3.1.4. tuple(元组)</a></li>
<li><a class="reference internal" href="#set">3.1.5. set(集合)</a></li>
<li><a class="reference internal" href="#dictionary">3.1.6. dictionary(字典)</a></li>
<li><a class="reference internal" href="#id2">3.1.7. 其他类型</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">3.2. 表达式</a></li>
<li><a class="reference internal" href="#id4">3.3. 控制流</a><ul>
<li><a class="reference internal" href="#id5">3.3.1. 条件判断</a></li>
<li><a class="reference internal" href="#id6">3.3.2. 迭代</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">3.4. 函数</a></li>
<li><a class="reference internal" href="#id8">3.5. python模块</a></li>
<li><a class="reference internal" href="#id9">3.6. 异常</a><ul>
<li><a class="reference internal" href="#id10">3.6.1. 捕获异常</a></li>
<li><a class="reference internal" href="#id11">3.6.2. 抛出异常</a></li>
<li><a class="reference internal" href="#id12">3.6.3. 自定义异常</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">3.7. 类、对象</a><ul>
<li><a class="reference internal" href="#id14">3.7.1. 类的定义和实例化</a></li>
<li><a class="reference internal" href="#id15">3.7.2. 类变量和实例变量</a></li>
<li><a class="reference internal" href="#id16">3.7.3. 继承</a></li>
<li><a class="reference internal" href="#id17">3.7.4. 私有变量</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18">3.8. 标准库</a><ul>
<li><a class="reference internal" href="#id19">3.8.1. 多线程</a></li>
<li><a class="reference internal" href="#id20">3.8.2. 文件目录操作</a></li>
<li><a class="reference internal" href="#socket">3.8.3. socket</a></li>
<li><a class="reference internal" href="#id21">3.8.4. 正则表达式</a></li>
<li><a class="reference internal" href="#id22">3.8.5. 参数解析库</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id23">3.9. 其他常见库</a><ul>
<li><a class="reference internal" href="#pyurl">3.9.1. 网络库pyurl</a></li>
<li><a class="reference internal" href="#py2exe-window">3.9.2. py2exe window下打包发布</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="chapter2.html"
                        title="previous chapter">2. python环境搭建</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="chapter4.html"
                        title="next chapter">4. python常见应用</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/chapter3.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="python">
<h1>3. python语言基础语法<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h1>
<p>本章主要根据 &#8220;python manual&#8221;(在安装python后附带)中的Tutorial简化整理而来。有时间可以查看官方原来的文档。遇到模块或函数不清楚的也可以查找Manual。</p>
<div class="section" id="id1">
<h2>3.1. 内置数据类型<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>和大多数动态语言一样，python中的变量是动态变量，所以定义时不需要指定变量类型，只跟实际赋值时有关(python的所有变量都是对象)。</p>
<div class="section" id="numbers">
<h3>3.1.1. numbers(数字)<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h3>
<p>数字的使用跟数学表达式一样:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">50</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>      <span class="c"># 数学表达式</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">7</span><span class="o">/</span><span class="mi">3</span>             <span class="c"># 默认返回floor</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">7</span><span class="o">/-</span><span class="mi">3</span>
<span class="go">-3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">7</span><span class="o">/</span><span class="mf">3.0</span>           <span class="c"># 浮点数</span>
<span class="go">2.3333333333333335</span>
</pre></div>
</div>
<p>变量赋值:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c"># 变量可以同时赋值</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span><span class="mi">200</span>   <span class="c"># 多个赋值</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="go">100 200</span>
</pre></div>
</div>
<p>进制转换:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">hex</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>          <span class="c"># 十六进制</span>
<span class="go">&#39;0x64&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">oct</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>          <span class="c"># 八进制</span>
<span class="go">&#39;0144&#39;</span>
</pre></div>
</div>
<p>ascii码转换:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>        <span class="c"># 字母转数值</span>
<span class="go">97</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span>         <span class="c"># 数值转字母</span>
<span class="go">&#39;a&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="string">
<h3>3.1.2. string(字符串)<a class="headerlink" href="#string" title="Permalink to this headline">¶</a></h3>
<p>python通过单引号、双引号或三重引号引起来的表示字符串。在这里，使用单引号和双引号完全是一样的，使用单引号做引用，字串中可以双引号字符；使用双引号，字串中可以包含单引号，否则，需要加转义字符:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;doesn</span><span class="se">\&#39;</span><span class="s">t&#39;</span>
<span class="go">&quot;doesn&#39;t&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;doesn&#39;t&quot;</span>
<span class="go">&quot;doesn&#39;t&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&quot;Yes,&quot; he said.&#39;</span>
<span class="go">&#39;&quot;Yes,&quot; he said.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">Yes,</span><span class="se">\&quot;</span><span class="s"> he said.&quot;</span>
<span class="go">&#39;&quot;Yes,&quot; he said.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&quot;Isn</span><span class="se">\&#39;</span><span class="s">t,&quot; she said.&#39;</span>
<span class="go">&#39;&quot;Isn\&#39;t,&quot; she said.&#39;</span>
</pre></div>
</div>
<p>跨行引用，则需要和用 <tt class="docutils literal"><span class="pre">\n</span></tt> 和 <tt class="docutils literal"><span class="pre">\</span></tt> 连接字符:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;Usage: thingy [OPTIONS]</span><span class="se">\n\</span>
<span class="go">     -h                        Display this usage message\n\</span>
<span class="go">     -H hostname               Hostname to connect to&quot;</span>
<span class="go">Usage: thingy [OPTIONS]</span>
<span class="go">     -h                        Display this usage message</span>
<span class="go">     -H hostname               Hostname to connect to</span>
</pre></div>
</div>
<p>使用三重引号，<tt class="docutils literal"><span class="pre">&quot;&quot;&quot;</span></tt> 或 <tt class="docutils literal"><span class="pre">'''</span></tt> ，可以更方便地跨行字串:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;&quot;&quot;</span>
<span class="go">Usage: thingy [OPTIONS]</span>
<span class="go">     -h                        Display this usage message</span>
<span class="go">     -H hostname               Hostname to connect to</span>
<span class="go">&quot;&quot;&quot;</span>

<span class="go">Usage: thingy [OPTIONS]</span>
<span class="go">     -h                        Display this usage message</span>
<span class="go">     -H hostname               Hostname to connect to</span>
</pre></div>
</div>
<p>原始字符串，通过在字符串前面加字母r，表示字串是raw string，不会对字串中的字符进行转义:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">r&quot;&quot;&quot;aaaaaaaa\nbbbb&quot;&quot;&quot;</span>
<span class="go">aaaaaaaa\nbbbb</span>
</pre></div>
</div>
<p>字符串可以通过+号进行连接，通过*号进行重复:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span> <span class="o">=</span> <span class="s">&#39;Help&#39;</span> <span class="o">+</span> <span class="s">&#39;A&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span>
<span class="go">&#39;HelpA&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">word</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span>
<span class="go">&#39;&lt;HelpAHelpAHelpAHelpAHelpA&gt;&#39;</span>
</pre></div>
</div>
<p>字串采用和C的一样的索引方式，下标从0开始。同时，子串可以使用分片的记法，冒号左边为开始字符的下标，右边为结束字符下标+1:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="go">&#39;A&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="go">&#39;He&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="go">&#39;lp&#39;</span>
</pre></div>
</div>
<p>分片记法还用两个方便的默认值，左边默认为0，右边默认为整个字符串长度:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>    <span class="c"># The first two characters</span>
<span class="go">&#39;He&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>    <span class="c"># Everything except the first two characters</span>
<span class="go">&#39;lpA&#39;</span>
</pre></div>
</div>
<p>分片记法，还可以使用负数下标，表示:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>     <span class="c"># The last character</span>
<span class="go">&#39;A&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>     <span class="c"># The last-but-one character</span>
<span class="go">&#39;p&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>    <span class="c"># The last two characters</span>
<span class="go">&#39;pA&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>    <span class="c"># Everything except the last two characters</span>
<span class="go">&#39;Hel&#39;</span>
</pre></div>
</div>
<p>取子字符串时，如果超过范围，会被自动截取:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span>
<span class="go">&#39;HelpA&#39;</span>
</pre></div>
</div>
<p>字符串还可以步进式地截取字符。如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<span class="go">&#39;HlA</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="c"># 倒序输出</span>
<span class="go">&#39;ApleH&#39;</span>
</pre></div>
</div>
<p>上面主要介绍字符串的截取和拼接，字符串其他常用操作如下:</p>
<ul>
<li><p class="first">去左右空白字符或特殊字符:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;  aaaa   &quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>          <span class="c"># 去左右空白字符</span>
<span class="go">aaaa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;  aaaa   &quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>         <span class="c"># lstrip去左侧空格,rstrip去右侧空格</span>
<span class="go">  aaaa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;  aaaa,,,...&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;,.!&#39;</span><span class="p">)</span> <span class="c"># 去指定字符</span>
<span class="go">&#39;  aaaa&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">取字符串长度:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="go">5</span>
</pre></div>
</div>
</li>
<li><p class="first">定位字符或子串:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;aaabbbccc&quot;</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;bb&#39;</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;aaabbbccc&quot;</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;bc&#39;</span><span class="p">)</span>
<span class="go">5</span>
</pre></div>
</div>
</li>
<li><p class="first">比较字符串:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">cmp</span><span class="p">(</span><span class="s">&#39;aa&#39;</span><span class="p">,</span><span class="s">&#39;bb&#39;</span><span class="p">)</span>
<span class="go">-1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">cmp</span><span class="p">(</span><span class="s">&#39;aa&#39;</span><span class="p">,</span><span class="s">&#39;aa&#39;</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">cmp</span><span class="p">(</span><span class="s">&#39;bb&#39;</span><span class="p">,</span><span class="s">&#39;aa&#39;</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</li>
<li><p class="first">字符串大小写转换:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;aaa&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="go">&#39;AAA&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;Aaaa&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="go">&#39;aaaa&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">字符串查找:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;aaabbbccc&#39;</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;bbb&#39;</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">index如果没找到会抛出异常，find没找到返回-1</p>
</div>
<ul>
<li><p class="first">字符串替换:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;aaabbbaaadddd&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">)</span>
<span class="go">&#39;eeebbbeeedddd&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;aaabbbaaadddd&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;aaa&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">)</span>
<span class="go">&#39;ebbbedddd&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">字符串分割:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;aaaaa;;bbb;;ccc;ddd;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;;&#39;</span><span class="p">)</span>
<span class="go">[&#39;aaaaa&#39;, &#39;bbb&#39;, &#39;ccc;ddd;&#39;]            # 字符串数组</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;aaaaa;bbb;ccc;ddd;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
<span class="go">[&#39;aaaaa&#39;, &#39;bbb&#39;, &#39;ccc&#39;, &#39;ddd&#39;, &#39;&#39;]</span>
</pre></div>
</div>
</li>
<li><p class="first">合并字符串:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;aaaa&#39;</span><span class="p">,</span> <span class="s">&#39;bbb&#39;</span><span class="p">,</span> <span class="s">&#39;ccc&#39;</span><span class="p">])</span>
<span class="go">&#39;aaaabbbccc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;aaaa&#39;</span><span class="p">,</span> <span class="s">&#39;bbb&#39;</span><span class="p">,</span> <span class="s">&#39;ccc&#39;</span><span class="p">])</span>
<span class="go">&#39;aaaa;bbb;ccc&#39;</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">python的字符串是不可修改的。如修改一个字符，应使用replace，或使用左边字串+新字符+右边字串拼接而成</p>
</div>
</div>
<div class="section" id="list">
<h3>3.1.3. list(数组)<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h3>
<p>python使用如下语法定义list，list的元素类型可以不一样:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;spam&#39;</span><span class="p">,</span> <span class="s">&#39;eggs&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1234</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[&#39;spam&#39;, &#39;eggs&#39;, 100, 1234]</span>
</pre></div>
</div>
<p>list访问的分片记法与字符串相似，而且一样使用+进行连接，<tt class="docutils literal"><span class="pre">*</span></tt> 进行重复:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">[&#39;eggs&#39;, 100]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;bacon&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>
<span class="go">[&#39;spam&#39;, &#39;eggs&#39;, &#39;bacon&#39;, 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;Boo!&#39;</span><span class="p">]</span>
<span class="go">[&#39;spam&#39;, &#39;eggs&#39;, 100, &#39;spam&#39;, &#39;eggs&#39;, 100, &#39;spam&#39;, &#39;eggs&#39;, 100, &#39;Boo!&#39;]</span>
</pre></div>
</div>
<p>与字符串不同，python的list是可以修改的:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># replace some values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="s">&#39;E&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;f&#39;, &#39;g&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># now remove them</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;f&#39;, &#39;g&#39;]</span>
</pre></div>
</div>
<p>返回list大小:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">4</span>
</pre></div>
</div>
<p>list可以嵌套，构造多维数组:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span>
<span class="go">[&#39;a&#39;, [&#39;a&#39;, &#39;b&#39;], &#39;b&#39;]</span>
</pre></div>
</div>
<p>list其他常用操作:</p>
<ul class="simple">
<li>append(x)         添加一个元素到末尾</li>
<li>extend(x)         相当于+</li>
<li>insert(i, x)      在i插入x</li>
<li>remove(x)         删除x</li>
<li>pop()             弹出</li>
<li>index(x)          返回第一个匹配x的下标</li>
<li>count(x)          返回匹配x的个数</li>
<li>sort(cmp=None, key=None, reverse=False)  排序</li>
<li>reverse()         生成反序数组</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">注意append和+的区别，append一个数组，是把数组当成一个元素添加进去，+数组是把所有元素添加进去</p>
</div>
<p>list还提供了一种叫做 <tt class="docutils literal"><span class="pre">list</span> <span class="pre">comprehensions</span></tt> 方法可以从一个list产生新的list，它参照了函数式编程中的filter-map-reduce的思想[参考第5章]:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span>
<span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">if</span> <span class="n">x</span><span class="o">%</span><span class="mi">2</span><span class="p">]</span>        <span class="c"># 返回list中奇数的平方</span>
<span class="go">[1, 9, 25, 49, 81]</span>
</pre></div>
</div>
</div>
<div class="section" id="tuple">
<h3>3.1.4. tuple(元组)<a class="headerlink" href="#tuple" title="Permalink to this headline">¶</a></h3>
<p>tuple由多个值和逗号组成，前后可加括号，也可以不加:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">54321</span><span class="p">,</span> <span class="s">&#39;hello!&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">12345</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">(12345, 54321, &#39;hello!&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>与list不同，tuple是不可修改的，所以不能修改tuple中的数据。tuple一般在赋值、打印或pack,unpack时使用。tuple打印的例子:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;Hello, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">)</span>  <span class="c">#此时tuple需要加()否则语法错误</span>
</pre></div>
</div>
</div>
<div class="section" id="set">
<h3>3.1.5. set(集合)<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h3>
<p>set是无序的，元素不重复的collection。主要用于成员检测和消除重复元素。集合可以由大括号、数组、字符串来生成。集合还支持并集、交集、差集等操作:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">set([1, 2, 3])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">([</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">])</span>
<span class="go">set([&#39;1&#39;, &#39;3&#39;, &#39;2&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;orange&#39;</span> <span class="ow">in</span> <span class="n">fruit</span>                 <span class="c"># fast membership testing</span>
<span class="go">True</span>


<span class="gp">&gt;&gt;&gt; </span><span class="c"># Demonstrate set operations on unique letters from two words</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s">&#39;abracadabra&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s">&#39;alacazam&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>                                  <span class="c"># unique letters in a</span>
<span class="go">set([&#39;a&#39;, &#39;r&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span>                              <span class="c"># letters in a but not in b</span>
<span class="go">set([&#39;r&#39;, &#39;d&#39;, &#39;b&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">|</span> <span class="n">b</span>                              <span class="c"># letters in either a or b</span>
<span class="go">set([&#39;a&#39;, &#39;c&#39;, &#39;r&#39;, &#39;d&#39;, &#39;b&#39;, &#39;m&#39;, &#39;z&#39;, &#39;l&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span>                              <span class="c"># letters in both a and b</span>
<span class="go">set([&#39;a&#39;, &#39;c&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span>                              <span class="c"># letters in a or b but not both</span>
<span class="go">set([&#39;r&#39;, &#39;d&#39;, &#39;b&#39;, &#39;m&#39;, &#39;z&#39;, &#39;l&#39;])</span>
</pre></div>
</div>
</div>
<div class="section" id="dictionary">
<h3>3.1.6. dictionary(字典)<a class="headerlink" href="#dictionary" title="Permalink to this headline">¶</a></h3>
<p>dictionary是无序的，键值对集合:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tel</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;jack&#39;</span><span class="p">:</span> <span class="mi">4098</span><span class="p">,</span> <span class="s">&#39;sape&#39;</span><span class="p">:</span> <span class="mi">4139</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tel</span><span class="p">[</span><span class="s">&#39;guido&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4127</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tel</span>
<span class="go">{&#39;sape&#39;: 4139, &#39;guido&#39;: 4127, &#39;jack&#39;: 4098}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tel</span><span class="p">[</span><span class="s">&#39;jack&#39;</span><span class="p">]</span>
<span class="go">4098</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">tel</span><span class="p">[</span><span class="s">&#39;sape&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tel</span><span class="p">[</span><span class="s">&#39;irv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4127</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tel</span>
<span class="go">{&#39;guido&#39;: 4127, &#39;irv&#39;: 4127, &#39;jack&#39;: 4098}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tel</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;guido&#39;, &#39;irv&#39;, &#39;jack&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;guido&#39;</span> <span class="ow">in</span> <span class="n">tel</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;sape&#39;</span><span class="p">,</span> <span class="mi">4139</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;guido&#39;</span><span class="p">,</span> <span class="mi">4127</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;jack&#39;</span><span class="p">,</span> <span class="mi">4098</span><span class="p">)])</span>
<span class="go">{&#39;sape&#39;: 4139, &#39;jack&#39;: 4098, &#39;guido&#39;: 4127}</span>
</pre></div>
</div>
<p>如果key是简单的字符串， dict也可以这样构造:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">sape</span><span class="o">=</span><span class="mi">4139</span><span class="p">,</span> <span class="n">guido</span><span class="o">=</span><span class="mi">4127</span><span class="p">,</span> <span class="n">jack</span><span class="o">=</span><span class="mi">4098</span><span class="p">)</span>
<span class="go">{&#39;sape&#39;: 4139, &#39;jack&#39;: 4098, &#39;guido&#39;: 4127}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">del操作可用于list, set, dictionary等可变的结构中，用于删除元素</p>
</div>
</div>
<div class="section" id="id2">
<h3>3.1.7. 其他类型<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>其他类型还有</p>
<ul class="simple">
<li>None 空值</li>
<li>True 为真的布尔类型</li>
<li>False 为假的布尔类型</li>
<li>deque 队列，需要import collections</li>
<li>nametuple 命名tuple</li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h2>3.2. 表达式<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>python中的表达式有以下特点:</p>
<ul>
<li><p class="first">语句不需要以 <tt class="docutils literal"><span class="pre">;</span></tt> 结束，不同的语句需要换行</p>
</li>
<li><p class="first">语法块(if,while,for,defun,class等)不是通过加大括号来确定范围，而是用:加对代码对齐的方式来确定，python通过语法强制对齐的方式，让代码更可读，如下面if代码块的例子:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># 加:，程序块多条语句用tab或空格对齐</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="mi">1</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
<span class="go">    print &#39;1&#39;</span>
<span class="go">    print &#39;2&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># 没对齐导致语法错误</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="mi">1</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
<span class="go">    print &#39;1&#39;</span>
<span class="go">      print &#39;2&#39;</span>

  File <span class="nb">&quot;&lt;pyshell#38&gt;&quot;</span>, line <span class="m">3</span>
    <span class="k">print</span> <span class="s">&#39;2&#39;</span>
    <span class="o">^</span>
<span class="gr">IndentationError</span>: <span class="n">unexpected indent</span>
</pre></div>
</div>
</li>
<li><p class="first">通过#号进行注释</p>
</li>
<li><p class="first">空语句  pass</p>
</li>
</ul>
</div>
<div class="section" id="id4">
<h2>3.3. 控制流<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>3.3.1. 条件判断<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>条件判断语法很简单，if...elif...else，如下:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Please enter an integer: &quot;</span><span class="p">))</span>
<span class="go">Please enter an integer: 42</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="go">    print &#39;Negative&#39;</span>
<span class="go">elif x == 0:</span>
<span class="go">    print &#39;Zero&#39;</span>
<span class="go">else:</span>
<span class="go">    print &#39;Positive&#39;</span>

<span class="go">Positive</span>
</pre></div>
</div>
<p>条件除了比较，还可以是一些操作。in和not in用来判断元素是否在序列中(list,tuple,set,string,dictionary等), is和not is用来判断元素是否是相同的对象:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;1&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;1&#39;</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;1&#39;</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">}</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;1&#39;</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&#39;1&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="go">True</span>
</pre></div>
</div>
<p>对对象的判断，如果对象不是None类型的，就返回True:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="go">    print &quot;It&#39;s True&quot;</span>


<span class="go">It&#39;s True</span>
</pre></div>
</div>
<p>复合条件有not, and, or, not的优先级最高, or的优先级最低, and和or的求值是采用正则序的，即从左到右判断条件，有需要判断时才会对某个条件表达式进行求值，and时一旦有个条件为False，或or时一旦有条件为True，后面的条件判断不会进行下去了。and或or的返回值是最后一个进行求值的条件表达式值:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">string1</span><span class="p">,</span> <span class="n">string2</span><span class="p">,</span> <span class="n">string3</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;Trondheim&#39;</span><span class="p">,</span> <span class="s">&#39;Hammer Dance&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">non_null</span> <span class="o">=</span> <span class="n">string1</span> <span class="ow">or</span> <span class="n">string2</span> <span class="ow">or</span> <span class="n">string3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">non_null</span>
<span class="go">Trondheim</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">不像c语言，python无法在条件判断中赋值。这样可以避免==和=易写错的情况</p>
</div>
</div>
<div class="section" id="id6">
<h3>3.3.2. 迭代<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>使用while进行迭代, continue, break等用法与C类似:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Odd:</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
<p>while中的条件表达式与if中的相同。</p>
<p>使用for进行迭代，一般使用for...in sequence的语法，sequence可以是list,dictionary等:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Learn&#39;</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
<span class="go">   print i, a[i]</span>

<span class="go">0 Learn</span>
<span class="go">1 python</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
<span class="go">    print v</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="go">    print key,value</span>
</pre></div>
</div>
<p>range用于生成list，一般用于遍历:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="go">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">[0, 5, 10, 15, 20, 25]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">[0, 3, 6, 9]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[0, -1, -2, -3, -4, -5, -6, -7, -8, -9]</span>
</pre></div>
</div>
<p>上面还提到, list等sequence一般都提供了comprehensions，使用for和表达式生成新的sequence:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="go">[1, 8]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>  <span class="c"># 两层循环</span>
<span class="go">[(1, 1), (1, 8), (2, 1), (2, 8)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>
<span class="go">{2: 4, 4: 16, 6: 36}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s">&#39;abracadabra&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">&#39;abc&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">set([&#39;r&#39;, &#39;d&#39;])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h2>3.4. 函数<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>使用def关键字定义函数，函数的参数，返回值与C类似, return语句没带值返回None，没有return语句，也返回None:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">fib2</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="c"># return Fibonacci series up to n</span>
<span class="go">    &quot;&quot;&quot;Return a list containing the Fibonacci series up to n.&quot;&quot;&quot;</span>
<span class="go">    result = []</span>
<span class="go">    a, b = 0, 1</span>
<span class="go">    while a &lt; n:</span>
<span class="go">        result.append(a)    # see below</span>
<span class="go">        a, b = b, a+b</span>
<span class="go">    return result</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f100</span> <span class="o">=</span> <span class="n">fib2</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>    <span class="c"># call it</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f100</span>                <span class="c"># write the result</span>
<span class="go">[0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]</span>
</pre></div>
</div>
<p>函数和C++一样，可以带默认参数。默认参数可以是当前已知的变量:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">i</span><span class="o">=</span><span class="mi">5</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="n">i</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">arg</span>
<span class="n">f</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">f</span><span class="p">()</span>
</pre></div>
</div>
<p>默认参数只求值一次，所以上面两个f调用产生的结果一致.</p>
<p>参数还可以使用keyword的方式赋值:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s">&#39;a stiff&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;voom&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;Norwegian Blue&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;-- This parrot wouldn&#39;t&quot;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span>
    <span class="k">print</span> <span class="s">&quot;if you put&quot;</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="s">&quot;volts through it.&quot;</span>
    <span class="k">print</span> <span class="s">&quot;-- Lovely plumage, the&quot;</span><span class="p">,</span> <span class="nb">type</span>
    <span class="k">print</span> <span class="s">&quot;-- It&#39;s&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="s">&quot;!&quot;</span>

<span class="n">parrot</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>                                          <span class="c"># 1 positional argument</span>
<span class="n">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>                                  <span class="c"># 1 keyword argument</span>
<span class="n">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;VOOOOOM&#39;</span><span class="p">)</span>             <span class="c"># 2 keyword arguments</span>
<span class="n">parrot</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s">&#39;VOOOOOM&#39;</span><span class="p">,</span> <span class="n">voltage</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>             <span class="c"># 2 keyword arguments</span>
<span class="n">parrot</span><span class="p">(</span><span class="s">&#39;a million&#39;</span><span class="p">,</span> <span class="s">&#39;bereft of life&#39;</span><span class="p">,</span> <span class="s">&#39;jump&#39;</span><span class="p">)</span>         <span class="c"># 3 positional arguments</span>
<span class="n">parrot</span><span class="p">(</span><span class="s">&#39;a thousand&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s">&#39;pushing up the daisies&#39;</span><span class="p">)</span>  <span class="c"># 1 positional, 1 keyword</span>
</pre></div>
</div>
<p>注意下面几种情况是非法的:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">parrot</span><span class="p">()</span>                     <span class="c"># required argument missing</span>
<span class="n">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="s">&#39;dead&#39;</span><span class="p">)</span>  <span class="c"># non-keyword argument after a keyword argument</span>
<span class="n">parrot</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">voltage</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span>     <span class="c"># duplicate value for the same argument</span>
<span class="n">parrot</span><span class="p">(</span><span class="n">actor</span><span class="o">=</span><span class="s">&#39;John Cleese&#39;</span><span class="p">)</span>  <span class="c"># unknown keyword argument</span>
</pre></div>
</div>
<p>函数支持变参, 定义函数时，一个 <tt class="docutils literal"><span class="pre">*</span></tt> 号是多个参数列表, 两个 <tt class="docutils literal"><span class="pre">*</span></tt> 号参数按字典解析:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cheeseshop</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;-- Do you have any&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="s">&quot;?&quot;</span>
    <span class="k">print</span> <span class="s">&quot;-- I&#39;m sorry, we&#39;re all out of&quot;</span><span class="p">,</span> <span class="n">kind</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">arg</span>
    <span class="k">print</span> <span class="s">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keywords</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">kw</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span>

<span class="n">cheeseshop</span><span class="p">(</span><span class="s">&quot;Limburger&quot;</span><span class="p">,</span> <span class="s">&quot;It&#39;s very runny, sir.&quot;</span><span class="p">,</span>
           <span class="s">&quot;It&#39;s really very, VERY runny, sir.&quot;</span><span class="p">,</span>
           <span class="n">shopkeeper</span><span class="o">=</span><span class="s">&#39;Michael Palin&#39;</span><span class="p">,</span>
           <span class="n">client</span><span class="o">=</span><span class="s">&quot;John Cleese&quot;</span><span class="p">,</span>
           <span class="n">sketch</span><span class="o">=</span><span class="s">&quot;Cheese Shop Sketch&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>它将打印:</p>
<div class="highlight-python"><div class="highlight"><pre>-- Do you have any Limburger ?
-- I&#39;m sorry, we&#39;re all out of Limburger
It&#39;s very runny, sir.
It&#39;s really very, VERY runny, sir.
----------------------------------------
client : John Cleese
shopkeeper : Michael Palin
sketch : Cheese Shop Sketch
</pre></div>
</div>
<p>调用函数时，也可以使用类似的 <tt class="docutils literal"><span class="pre">*</span></tt> 号标记来unpack参数列表或字典:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>             <span class="c"># normal call with separate arguments</span>
<span class="go">[3, 4, 5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>            <span class="c"># call with arguments unpacked from a list</span>
<span class="go">[3, 4, 5]</span>
</pre></div>
</div>
<p>unpack字典参数:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s">&#39;a stiff&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;voom&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;-- This parrot wouldn&#39;t&quot;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;if you put&quot;</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="s">&quot;volts through it.&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;E&#39;s&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="s">&quot;!&quot;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;voltage&quot;</span><span class="p">:</span> <span class="s">&quot;four million&quot;</span><span class="p">,</span> <span class="s">&quot;state&quot;</span><span class="p">:</span> <span class="s">&quot;bleedin&#39; demised&quot;</span><span class="p">,</span> <span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="s">&quot;VOOM&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parrot</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
<span class="go">-- This parrot wouldn&#39;t VOOM if you put four million volts through it. E&#39;s bleedin&#39; demised !</span>
</pre></div>
</div>
<ul class="simple">
<li>lambda表达式</li>
</ul>
<p>小的匿名函数可以使用lambda表达式代替(lambda表达式是函数式编程中的重要思想):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">make_incrementor</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="go">    return lambda x: x + n</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">make_incrementor</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">43</span>
</pre></div>
</div>
<p>上面使用lambda返回一个函数，另一种表示是把lambda函数当参数:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;four&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pairs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pairs</span>
<span class="go">[(4, &#39;four&#39;), (1, &#39;one&#39;), (3, &#39;three&#39;), (2, &#39;two&#39;)]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">语言如果使用lambda，一般都要涉及局部变量(状态)，函数作为参数等概念，在一些函数式编程语言中，函数只是lambda的语法糖，即函数只是命了名的lambda表达式。</p>
</div>
<p>在sicp中提到可以使用过程来代替数据结构，来达到代码和数据的优雅统一。如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#使用过程来代替数据结构--序对</span>
<span class="k">def</span> <span class="nf">cons</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">y</span>

<span class="c">#取第一个数</span>
<span class="k">def</span> <span class="nf">car</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># 取第二个数</span>
<span class="k">def</span> <span class="nf">cdr</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">d</span><span class="o">=</span><span class="n">cons</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">cons</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>
<span class="k">print</span> <span class="n">car</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">car</span><span class="p">(</span><span class="n">cdr</span><span class="p">(</span><span class="n">d</span><span class="p">)),</span> <span class="n">cdr</span><span class="p">(</span><span class="n">cdr</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
</pre></div>
</div>
<p>上面例子中，通过使用返回的lambda，定义了序对数据结构，通过cons构造，car和cdr来取序对的值，从而实现了一个基础的
数据结构(lisp系的数据全是基于list的，而list又可以用序列表示)，而不用任何定义结构体的语句(这就是函数式编程语法简单的一个例子)。</p>
<p>python支持自省，就是说可以在函数，类的定义中加入文档:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;Do nothing, but document it.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    No, really, it doesn&#39;t do anything.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">my_function</span><span class="o">.</span><span class="n">__doc__</span>
<span class="go">Do nothing, but document it.</span>

<span class="go">    No, really, it doesn&#39;t do anything.</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h2>3.5. python模块<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>python中每个py文件就是一个模块。每个模块中有个全局变量__name__标志模块名。在别的模块调用一个模块时，使用import语法，如在fibo.py中输入以下函数:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>    <span class="c"># write Fibonacci series up to n</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">b</span><span class="p">,</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="k">def</span> <span class="nf">fib2</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="c"># return Fibonacci series up to n</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>然后，在另一个文件可以这样调用:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">fibo</span>
<span class="n">fibo</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>import还存在另一种写法, 它把函数直接导入发起导入的模块的符号表中:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fibo</span> <span class="kn">import</span> <span class="n">fib</span><span class="p">,</span> <span class="n">fib2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>            <span class="c"># 不需要再加模块名了</span>
<span class="go">1 1 2 3 5 8 13 21 34 55 89 144 233 377</span>
</pre></div>
</div>
<p>或者全部导入:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fibo</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="go">1 1 2 3 5 8 13 21 34 55 89 144 233 377</span>
</pre></div>
</div>
<p>当你使用:</p>
<div class="highlight-python"><div class="highlight"><pre>python fibo.py &lt;arguments&gt;
</pre></div>
</div>
<p>时，__name__被自动设置为&#8221;__main__&#8221;，所以你可以在py中加入如下的判断:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">fib</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>那么py即可以直接调用，也可以在别的模块中被引用。</p>
<p>python的模块搜索目录存在sys.path变量中，默认值包括三个:</p>
<ul class="simple">
<li>当前目录</li>
<li>PATH系统目录</li>
<li>python的安装目录</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
<span class="go">[&#39;&#39;, &#39;C:\\Python27\\Lib\\idlelib&#39;, &#39;C:\\Python27\\lib\\site-packages\\setuptools-14.0-py2.7.egg&#39;, &#39;C:\\Python27\\lib\\site-packages\\sphinx-1.3b3-py2.7.egg&#39;, &#39;C:\\Python27\\lib\\site-packages\\colorama-0.3.3-py2.7.egg&#39;, &#39;C:\\Python27\\lib\\site-packages\\sphinx_rtd_theme-0.1.6-py2.7.egg&#39;, &#39;C:\\Python27\\lib\\site-packages\\alabaster-0.7.1-py2.7.egg&#39;, &#39;C:\\Python27\\lib\\site-packages\\babel-1.3-py2.7.egg&#39;, &#39;C:\\Python27\\lib\\site-packages\\pytz-2014.10-py2.7.egg&#39;, &#39;C:\\Python27\\lib\\site-packages\\pip-6.0.8-py2.7.egg&#39;, &#39;C:\\Windows\\system32\\python27.zip&#39;, &#39;C:\\Python27\\DLLs&#39;, &#39;C:\\Python27\\lib&#39;, &#39;C:\\Python27\\lib\\plat-win&#39;, &#39;C:\\Python27\\lib\\lib-tk&#39;, &#39;C:\\Python27&#39;, &#39;C:\\Python27\\lib\\site-packages&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;/ufs/guido/lib/python&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first">使用dir来获取模块信息</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fibo</span><span class="o">,</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">fibo</span><span class="p">)</span>
<span class="go">[&#39;__name__&#39;, &#39;fib&#39;, &#39;fib2&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="go">[&#39;__displayhook__&#39;, &#39;__doc__&#39;, &#39;__excepthook__&#39;, &#39;__name__&#39;, &#39;__package__&#39;,</span>
<span class="go"> &#39;__stderr__&#39;, &#39;__stdin__&#39;, &#39;__stdout__&#39;, &#39;_clear_type_cache&#39;,</span>
<span class="go"> &#39;_current_frames&#39;, &#39;_getframe&#39;, &#39;_mercurial&#39;, &#39;api_version&#39;, &#39;argv&#39;,</span>
<span class="go"> &#39;builtin_module_names&#39;, &#39;byteorder&#39;, &#39;call_tracing&#39;, &#39;callstats&#39;,</span>
<span class="go"> &#39;copyright&#39;, &#39;displayhook&#39;, &#39;dont_write_bytecode&#39;, &#39;exc_clear&#39;, &#39;exc_info&#39;,</span>
<span class="go"> &#39;exc_traceback&#39;, &#39;exc_type&#39;, &#39;exc_value&#39;, &#39;excepthook&#39;, &#39;exec_prefix&#39;,</span>
<span class="go"> &#39;executable&#39;, &#39;exit&#39;, &#39;flags&#39;, &#39;float_info&#39;, &#39;float_repr_style&#39;,</span>
<span class="go"> &#39;getcheckinterval&#39;, &#39;getdefaultencoding&#39;, &#39;getdlopenflags&#39;,</span>
<span class="go"> &#39;getfilesystemencoding&#39;, &#39;getobjects&#39;, &#39;getprofile&#39;, &#39;getrecursionlimit&#39;,</span>
<span class="go"> &#39;getrefcount&#39;, &#39;getsizeof&#39;, &#39;gettotalrefcount&#39;, &#39;gettrace&#39;, &#39;hexversion&#39;,</span>
<span class="go"> &#39;long_info&#39;, &#39;maxint&#39;, &#39;maxsize&#39;, &#39;maxunicode&#39;, &#39;meta_path&#39;, &#39;modules&#39;,</span>
<span class="go"> &#39;path&#39;, &#39;path_hooks&#39;, &#39;path_importer_cache&#39;, &#39;platform&#39;, &#39;prefix&#39;, &#39;ps1&#39;,</span>
<span class="go"> &#39;py3kwarning&#39;, &#39;setcheckinterval&#39;, &#39;setdlopenflags&#39;, &#39;setprofile&#39;,</span>
<span class="go"> &#39;setrecursionlimit&#39;, &#39;settrace&#39;, &#39;stderr&#39;, &#39;stdin&#39;, &#39;stdout&#39;, &#39;subversion&#39;,</span>
<span class="go"> &#39;version&#39;, &#39;version_info&#39;, &#39;warnoptions&#39;]</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id9">
<h2>3.6. 异常<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>3.6.1. 捕获异常<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>python的捕获异常语法，如下例子:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">code_block</span><span class="p">()</span>
<span class="k">except</span> <span class="n">SomeException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">do_some_thing_with_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="n">Exception1</span><span class="p">,</span> <span class="n">Exception2</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">do_some_thing_with_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">do_some_thing_with_other_exceptions</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">do_some_thing_when_success</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">do_some_thing</span><span class="p">()</span>
</pre></div>
</div>
<p>其中，except可以使用else分支，来匹配try运行无异常的情况, finally是不管有无异常都会执行。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">python2.7.x和python3.x的异常语法不太一样。</p>
</div>
</div>
<div class="section" id="id11">
<h3>3.6.2. 抛出异常<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>python使用raise来抛出异常:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">,</span> <span class="s">&#39;HiThere&#39;</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;An exception flew by!&#39;</span>
    <span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>raise 函式的第一个参数是异常名，第二个是这个异常的实例，它存储在 instance.args 的参
数中。和 except NameError, a: 中的第二个参数意思差不多。</p>
</div>
<div class="section" id="id12">
<h3>3.6.3. 自定义异常<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>异常类中可以定义任何其他类中可以定义的东西，但是通常为了保持简单，只在其中加
入几个属性信息，以供异常处理句柄提取:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">MyError</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="k">except</span> <span class="n">MyError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;My exception occurred, value:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>如果一个新创建的模块中须抛出几种不同的错误时，一个通常的做法是为该模块定义一个异常基类，然后针对不同的错误类型派生出对应的异常子类。</p>
</div>
</div>
<div class="section" id="id13">
<h2>3.7. 类、对象<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id14">
<h3>3.7.1. 类的定义和实例化<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>一个简单的例子如下:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
<span class="go">    &quot;&quot;&quot;A simple class.&quot;&quot;&quot;           #__doc__</span>
<span class="go">    i=10000</span>
<span class="go">    def __init__(self, p1, p2):     # 构造函数</span>
<span class="go">        self.r = p1</span>
<span class="go">        self.i = p2</span>
<span class="go">    def f(self):</span>
<span class="go">        print self.r+self.i</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5</span><span class="p">)</span>          <span class="c"># 实例化</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">i</span>
<span class="go">(3.0, -4.5)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">f</span><span class="p">()</span>
<span class="go">-1.5</span>
</pre></div>
</div>
<p>需要注意的是，定义一个类时，python会产生一个类对象。类对象中属性、函数可以修改:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">MyClass</span><span class="o">.</span><span class="n">i</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">MyClass</span><span class="o">.</span><span class="n">f</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyClass</span><span class="o">.</span><span class="n">j</span><span class="o">=</span><span class="mi">10000</span>
</pre></div>
</div>
<p>类对象中可以使用 __doc__打印类定义中的帮助字符串</p>
<p>实例化类的后，就产生了一个实例对象。实例对象中的属性也可以修改，如上面MyClass对象
没有定义j属性，但是在它赋值时会自动创建一个:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">x</span><span class="o">.</span><span class="n">j</span>
</pre></div>
</div>
<p>实例对象中的函数和MyClass中的函数看起来不太一样。大家注意到类对象中定义函数时第一
个参数总是self，而调用实例对象中的函数时，可以少加一个参数，事实上如下的调用是完全等价的:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">f</span><span class="p">()</span>
<span class="go">-1.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyClass</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">-1.5</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h3>3.7.2. 类变量和实例变量<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>类变量和实例变量:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Dog</span><span class="p">:</span>
<span class="go">    kind = &#39;canine&#39;         # 类变量，被所有实例共享</span>
<span class="go">    def __init__(self, name):</span>
<span class="go">        self.name = name    # 实例变量</span>
<span class="go">        # self.__class__.kind = &#39;bbb&#39;  # 修改类变量</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">(</span><span class="s">&#39;Fido&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">(</span><span class="s">&#39;Buddy&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">d</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">Dog</span><span class="o">.</span><span class="n">kind</span>
<span class="go">canine canine canine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s">&#39;bbbb&#39;</span>         <span class="c"># 注意kind已经变成e的实例变量</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">d</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">Dog</span><span class="o">.</span><span class="n">kind</span>  <span class="c"># d中没有kind实例变量，所以d.kind还是类中的变量</span>
<span class="go">canine bbbb canine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Dog</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s">&#39;kkkk&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">d</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">Dog</span><span class="o">.</span><span class="n">kind</span>
<span class="go">kkkk bbbb kkkk              # d.kind仍与Dog.kind一样</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h3>3.7.3. 继承<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>使用如下语法继承或多重继承:</p>
<div class="highlight-python"><div class="highlight"><pre>class DerivedClassName(BaseClassName1, BaseClassName2):
    &lt;statement-1&gt;
    .
    .
    .
    &lt;statement-N&gt;
</pre></div>
</div>
<p>子类中可以使用 <tt class="docutils literal"><span class="pre">BaseClassName.methodname(self,</span> <span class="pre">arguments)</span></tt> 调用父类的方法</p>
<p>python 还提供两个函数用于实例检查:</p>
<ul class="simple">
<li>isinstance, 如instance(obj, int)检测obj是否是int类型</li>
<li>issubclass, 如issubclass(bool, int)检测bool是否是int的子类</li>
</ul>
<p>多重继承时，规则是深度优先，从左到右。如下面的例子，搜索一个变量是否存在时，顺序是DerivedClassName
然后是BaseClassName1，BaseClassName1的父类，BaseClassName2等。</p>
</div>
<div class="section" id="id17">
<h3>3.7.4. 私有变量<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>一个变量前面以及下划线开始会被当成私有变量，不管它是函数还是属性。</p>
</div>
</div>
<div class="section" id="id18">
<h2>3.8. 标准库<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id19">
<h3>3.8.1. 多线程<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>threading 模块主要功能是让一些线程的操作对象化了，创建了叫 Thread 的类。
使用线程有两种方法:</p>
<ul class="simple">
<li>一种是创建线程要执行的函式，把这个函式传递进 Thread 对象里，让它来执行，如下所示。</li>
</ul>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">thread_main</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">count</span><span class="p">,</span> <span class="n">mutex</span>
    <span class="c"># 获得线程名</span>
    <span class="n">threadname</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">currentThread</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="c"># 取得锁</span>
        <span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">print</span> <span class="n">threadname</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">count</span>
        <span class="c"># 释放锁</span>
        <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">count</span><span class="p">,</span> <span class="n">mutex</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c"># 创建一个锁</span>
    <span class="n">mutex</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="c"># 先创建线程对象</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_main</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,)))</span>
    <span class="c"># 启动所有线程</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c"># 主线程中等待所有子线程退出</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c"># 创建2个线程</span>
    <span class="n">main</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>第二种方法是直接从 Thread 继承，创建一个新的类，把线程执行的代码放到这个新类里，如下所示。</li>
</ul>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_num</span> <span class="o">=</span> <span class="n">num</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">count</span><span class="p">,</span> <span class="n">mutex</span>
        <span class="n">threadname</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">currentThread</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_num</span><span class="p">)):</span>
            <span class="c"># 取得锁</span>
            <span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="n">threadname</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">count</span>
            <span class="c"># 释放锁</span>
            <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">count</span><span class="p">,</span> <span class="n">mutex</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c"># 创建锁</span>
    <span class="n">mutex</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="c"># 创建线程对象</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Test</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="c"># 启动线程</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c"># 等待子线程结束</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        
</pre></div>
</td></tr></table></div>
<p>上述输出类似:</p>
<div class="highlight-python"><div class="highlight"><pre>mymac:code vincent$ python threading_1.py
Thread-1 0 2
Thread-2 0 3
Thread-1 1 4
Thread-2 1 5
Thread-1 2 6
Thread-2 2 7
Thread-1 3 8
Thread-2 3 9
Thread-1 4 10
Thread-2 4 11
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h3>3.8.2. 文件目录操作<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p><strong>文件路径</strong></p>
<p>os.path 是一个与平台无关的文件路径处理模块。它可以帮助我们解决在程序处理中碰到
的一些复杂的路径处理问题，我们用简单的字符串拆分这些路径处理问题是很困难或者无法完成的，但是 os.path 都替你做好了解决方案，你只须使用
它里面的函式就可以了。</p>
<ul class="simple">
<li>os.path.basename      返回文件名</li>
<li>os.path.dirname       返回路径名</li>
<li>os.path.commonprefix  从一组路径中，找到共同的路径前缀</li>
<li>os.path.join，        组合一些零散的字符串，生成一个安全的路径表示</li>
<li>os.path.normpath      处理不规则路径字符串，将其转化为正常的路径</li>
<li>os.path.abspath       获取绝对路径</li>
</ul>
<p><strong>目录操作</strong></p>
<p>目录操作，一般使用os模块和shutil模块:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 存在目录，删除原来目录，重新创建目录</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">gDstDir</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">gDstDir</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">gDstDir</span><span class="p">);</span>

<span class="c"># 遍历目录、文件，取java文件</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">gSrcDir</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">root</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&quot;dir: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">nd</span>
    <span class="k">for</span> <span class="n">nf</span> <span class="ow">in</span> <span class="p">[</span><span class="n">root</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.java&quot;</span><span class="p">)]:</span>
        <span class="k">print</span> <span class="s">&quot;file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">nf</span>
</pre></div>
</div>
<p><strong>文件复制、删除</strong></p>
<p>文件操作也使用os模块和shutil:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s">&#39;data.db&#39;</span><span class="p">,</span> <span class="s">&#39;archive.db&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s">&#39;/build/executables&#39;</span><span class="p">,</span> <span class="s">&#39;installdir&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;data.db&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>文件读写</strong></p>
<p>文件读写与c中类似:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 读取全部内容</span>
<span class="n">content</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c"># 按行读</span>
<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">l</span>

<span class="c"># 写入文件</span>
<span class="n">ofd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="n">ofd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;aaa&#39;</span><span class="p">)</span>
<span class="n">ofd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="socket">
<h3>3.8.3. socket<a class="headerlink" href="#socket" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>tcp客户端代码:</li>
</ul>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#coding:utf-8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on 2013-10-21</span>

<span class="sd">@author: vincent</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span><span class="p">,</span><span class="n">Lock</span>

<span class="k">class</span> <span class="nc">SocketThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">print</span> <span class="s">&#39;geturllwork</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
		<span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;192.168.2.119&#39;</span><span class="p">,</span> <span class="mi">8001</span><span class="p">))</span>
		<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#39;aaaaaaaaa&#39;</span><span class="p">)</span>
		<span class="k">print</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
		<span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">dealUrlThreads</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
		<span class="n">dealUrlThreads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SocketThread</span><span class="p">())</span>
		<span class="n">dealUrlThreads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>	
	
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dealUrlThreads</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>tcp服务端代码:</li>
</ul>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#coding:utf-8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on 2013-10-21</span>

<span class="sd">@author: vincent</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
	<span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8001</span><span class="p">))</span>
	<span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		<span class="n">connection</span><span class="p">,</span><span class="n">address</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">connection</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
			<span class="n">buf</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">buf</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
				<span class="n">connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#39;welcome to server!&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#39;please go out!&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&#39;time out&#39;</span>
		<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>udp客户端代码:</li>
</ul>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#coding:utf-8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on 2013-10-21</span>

<span class="sd">@author: vincent</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">textport</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>


<span class="c">#s.bind((&#39;&#39;, 54320))</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">textport</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getservbyname</span><span class="p">(</span><span class="n">textport</span><span class="p">,</span> <span class="s">&#39;udp&#39;</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="c">#print &quot;Enter data to transmit:&quot;</span>
    <span class="c">#data = sys.stdin.readline().strip()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;mydata&#39;</span>
    <span class="n">s</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Looking for replies; press Ctrl-C or Ctrl-Break to stop.&quot;</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
    <span class="c">#buf = s.recvfrom()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">):</span>
        <span class="k">break</span>
    <span class="k">print</span> <span class="s">&quot;Server replies: &quot;</span><span class="p">,</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    
    
    
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>udp服务端代码:</li>
</ul>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#coding:utf-8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on 2013-10-21</span>

<span class="sd">@author: vincent</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">traceback</span>
 
<span class="n">host</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">54321</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">message</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Got data from&quot;</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="s">&quot;: &quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">+</span><span class="s">&quot;.echo&quot;</span>
        <span class="n">s</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
        <span class="k">raise</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id21">
<h3>3.8.4. 正则表达式<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p><strong>正则表达式语法</strong></p>
<p>python使用的是perl系的正则表达式语法。具体语法可以查看python文档中的re模块，这里只列表常见的</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">.</span></tt>, <tt class="docutils literal"><span class="pre">*</span></tt>, <tt class="docutils literal"><span class="pre">?</span></tt>, <tt class="docutils literal"><span class="pre">+</span></tt>, 不解释</li>
<li><tt class="docutils literal"><span class="pre">^</span></tt>, <tt class="docutils literal"><span class="pre">$</span></tt>, 匹配行首行尾, 在多行匹配模式下,会匹配每行</li>
<li><tt class="docutils literal"><span class="pre">*?</span></tt>, <tt class="docutils literal"><span class="pre">+?</span></tt>, <tt class="docutils literal"><span class="pre">??</span></tt>，没加?是贪婪匹配，加了?后是最短匹配</li>
<li><tt class="docutils literal"><span class="pre">{m}</span></tt>   刚好m个</li>
<li><tt class="docutils literal"><span class="pre">{m,n}</span></tt> 和 <tt class="docutils literal"><span class="pre">{m,n}?</span></tt>，匹配m到n个，加?最少匹配</li>
<li><tt class="docutils literal"><span class="pre">\</span></tt>，转义字符，上述 <tt class="docutils literal"><span class="pre">?</span></tt> 等需要转义</li>
<li><tt class="docutils literal"><span class="pre">[]</span></tt>, 字符集合, 在 <tt class="docutils literal"><span class="pre">[]</span></tt> 中除了 <tt class="docutils literal"><span class="pre">]`</span> <span class="pre">需要转义，其他</span> <span class="pre">```*</span></tt> 等，只当字符，另外 <tt class="docutils literal"><span class="pre">\w</span></tt> 也可用，第一个字符是 <tt class="docutils literal"><span class="pre">^</span></tt>， 则表示排除后面的字符</li>
<li><tt class="docutils literal"><span class="pre">|</span></tt>， 或者 <tt class="docutils literal"><span class="pre">A|B</span></tt> 表示，或者匹配A或者匹配B, 如果是 <tt class="docutils literal"><span class="pre">|</span></tt> 字符，则需要加转义</li>
<li><tt class="docutils literal"><span class="pre">(...)</span></tt> 匹配组，通过加括号，把匹配的结果按组捕获</li>
<li><tt class="docutils literal"><span class="pre">\number</span></tt> ，重复匹配项目，如 <tt class="docutils literal"><span class="pre">(.+)</span> <span class="pre">\1</span></tt> 将匹配 <tt class="docutils literal"><span class="pre">55</span> <span class="pre">55</span></tt></li>
<li><tt class="docutils literal"><span class="pre">(?P&lt;name&gt;...)</span></tt> 和 <tt class="docutils literal"><span class="pre">(?P=name)</span></tt>，给匹配的组加了个name，与上两条匹配和引用的方式相似。</li>
<li><tt class="docutils literal"><span class="pre">(?:...)</span></tt>  组，但是不捕获结果</li>
<li><tt class="docutils literal"><span class="pre">(?=...)</span></tt> 前向匹配</li>
<li><tt class="docutils literal"><span class="pre">(?!...)</span></tt> 前向不匹配</li>
<li><tt class="docutils literal"><span class="pre">(?&lt;=...)</span></tt> 后向匹配</li>
<li><tt class="docutils literal"><span class="pre">(?&lt;！...)</span></tt> 后向不匹配</li>
<li><tt class="docutils literal"><span class="pre">(?(id/name)yes-pattern|no-pattern)</span></tt> 如果group 存在匹配yes-pattern，如果不存在匹配no-pattern，group是否存在通过id或name进行判断</li>
<li><tt class="docutils literal"><span class="pre">\d</span></tt>, <tt class="docutils literal"><span class="pre">\w</span></tt>, <tt class="docutils literal"><span class="pre">\s</span></tt> 分别表示 数字、字母和数字、空白字符</li>
<li><tt class="docutils literal"><span class="pre">\D</span></tt>, <tt class="docutils literal"><span class="pre">\W</span></tt>, <tt class="docutils literal"><span class="pre">\S</span></tt> 分别表示 非数字、非字母也非数字、非空白字符</li>
</ul>
<p><strong>正则表达式工具(RegexBuddy)</strong></p>
<p>复杂的正则表达式可能很容易写错，可以借助正则表达式工具进行测试，推荐regexbuddy，下图所示了使用regexbuddy测试，匹配objective-c中类中属性的正则表达式。</p>
<a class="reference internal image-reference" href="_images/3.1.png"><img alt="_images/3.1.png" src="_images/3.1.png" style="width: 740px;" /></a>
<p><strong>使用正则表达式进行匹配</strong></p>
<p>上面介绍了正则的语法，还有测试正则语法的工具。下面介绍python下如果使用正则匹配，并获取匹配的结果</p>
<ul class="simple">
<li>re.search(pattern, string, flags=0)</li>
</ul>
<p>从string中查找pattern,如果符合pattern,则返回一个match的对象,否则返回None</p>
<ul class="simple">
<li>re.match(pattern, string, flags=0)</li>
</ul>
<p>match与search类似，只不过它是判断整个字符串是否匹配:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">re</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">=</span><span class="s">&#39;a{3}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;bbbbaaaddd&#39;</span><span class="p">)</span>
<span class="go">&lt;_sre.SRE_Match object at 0x01DF7950&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&#39;bbbbaaaddd&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;\w*&#39;</span><span class="p">,</span> <span class="s">&#39;bbbbaaaddd&#39;</span><span class="p">)</span>
<span class="go">&lt;_sre.SRE_Match object at 0x01DF79C0&gt;</span>
</pre></div>
</div>
<p>match对象的group, groups函数可以获取捕获的group信息:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">=</span><span class="s">&#39;&#39;&#39;(\w*(a{3})\w*(</span><span class="se">\1</span><span class="s">))&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gg</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;bbbbaaadddaaa&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gg</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="go">&#39;bbbbaaaddd&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gg</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="go">(&#39;bbbbaaaddd&#39;, &#39;aaa&#39;)</span>
</pre></div>
</div>
<ul class="simple">
<li>re.compile(pattern, flags=0)</li>
</ul>
<p>经常使用的正则模式，可以使用compile，提高效率</p>
<ul class="simple">
<li>re.findall(pattern, string, flags=0)</li>
</ul>
<p>findall从正则中获取匹配后的group，一般比较实用，如上面获取属性的例子:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="c"># 一般加re.S表示.也可以匹配\n</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;(?i)(?:@property.*?\)\s*?(\w.*?);)&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<span class="n">test</span><span class="o">=</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">@interface ChannelAttribute : PortalBaseObject</span>
<span class="s">// XXX: 频道id</span>
<span class="s">// 频道号</span>
<span class="s">@property (nonatomic, strong) NSString *channelCode;</span>

<span class="s">// 频道名称</span>
<span class="s">@property (nonatomic, strong) NSString *caption;</span>

<span class="s">// 频道logo图片的地址，相对路径</span>
<span class="s">@property (nonatomic, strong) NSString *logo;</span>

<span class="s">// OTT/VOD</span>
<span class="s">@property (nonatomic, strong) NSString *serviceCode;</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">propertys</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">propertys</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">p</span>
</pre></div>
</div>
<p>上述例子将输出该类的所有属性:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NSString</span> <span class="o">*</span><span class="n">channelCode</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">caption</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">logo</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">serviceCode</span>
</pre></div>
</div>
<ul class="simple">
<li>re.sub(pattern, repl, string, count=0, flags=0)</li>
</ul>
<p>把符合pattern的部分替换成repl，repl可以是新字符串，或者更复杂的函数:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">=</span><span class="s">&quot;111 222 333&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\d*(?=\s|$)&#39;</span><span class="p">,</span> <span class="s">&#39;444&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="go">&#39;444 444 444&#39;</span>

<span class="go">def add100(matched):</span>
<span class="go">    intStr = matched.groups()[0]</span>
<span class="go">    intValue = int(intStr)</span>
<span class="go">    return str(intValue+100)</span>

<span class="go"># 匹配的数全部替换成+100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;(\d*)(?=\s|$)&#39;</span><span class="p">,</span> <span class="n">add100</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="go">&#39;211 322 433&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h3>3.8.5. 参数解析库<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>使用命令行，经常要复杂的参数。可以使用OptionParser库，如有下列格式的参数:</p>
<div class="highlight-python"><div class="highlight"><pre>epgTool [-f &lt;filename&gt;][-D &lt;dirpath&gt;][-d &lt;date&gt;]
</pre></div>
</div>
<p>则可以使用OptionParser解析如下:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">MSG_USAGE</span> <span class="o">=</span> <span class="s">&quot;epgTool [-f &lt;filename&gt;][-D &lt;dirpath&gt;][-d &lt;date&gt;]&quot;</span>

<span class="n">optParser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">MSG_USAGE</span><span class="p">)</span>
<span class="n">optParser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span><span class="s">&quot;--file&quot;</span><span class="p">,</span><span class="n">action</span> <span class="o">=</span> <span class="s">&quot;store&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="n">dest</span> <span class="o">=</span> <span class="s">&quot;filename&quot;</span><span class="p">)</span>
<span class="n">optParser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-D&quot;</span><span class="p">,</span><span class="s">&quot;--dir&quot;</span><span class="p">,</span><span class="n">action</span> <span class="o">=</span> <span class="s">&quot;store&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="n">dest</span> <span class="o">=</span> <span class="s">&quot;dir&quot;</span><span class="p">)</span>
<span class="n">optParser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-d&quot;</span><span class="p">,</span><span class="s">&quot;--date&quot;</span><span class="p">,</span><span class="n">action</span> <span class="o">=</span> <span class="s">&quot;store&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="n">dest</span> <span class="o">=</span> <span class="s">&quot;date&quot;</span><span class="p">)</span>

<span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">optParser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c"># 解析后，-f, -D, -d 后面跟的参数，存到下面变量中</span>
<span class="k">print</span> <span class="n">options</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span><span class="n">date</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">optParser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
    <span class="nb">exit</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">dir</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
    <span class="n">optParser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
    <span class="nb">exit</span><span class="p">()</span>
<span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">date</span><span class="p">,</span><span class="n">dateFmt</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;error: day format must like: 14/05/20&#39;</span>
        <span class="nb">exit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id23">
<h2>3.9. 其他常见库<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pyurl">
<h3>3.9.1. 网络库pyurl<a class="headerlink" href="#pyurl" title="Permalink to this headline">¶</a></h3>
<p>curl库是c下的用来发http请求的工具，python下有对应的实现pycurl，安装方法仍使用pip，简单的使用例子如下:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#encoding:utf8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on 2011-4-28</span>

<span class="sd">@author: vincent</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">pycurl</span><span class="o">,</span><span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">StringIO</span>

<span class="c"># 需要伪装</span>
<span class="k">def</span> <span class="nf">getHtmlRead</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">USERAGENT</span><span class="p">,</span> <span class="s">&quot;Mozilla/4.0 (compatible; MSIE 6.0; &quot;</span>\
                                <span class="s">&quot;Windows NT 5.1; SV1; .NET CLR 2.0.50727)&quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">FOLLOWLOCATION</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">MAXREDIRS</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  
<span class="c">#    c.setopt(pycurl.CONNECTTIMEOUT, 60)   </span>
<span class="c">#    c.setopt(pycurl.TIMEOUT, 300)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;html read error</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">postHtmlRead</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">USERAGENT</span><span class="p">,</span> <span class="s">&quot;Mozilla/4.0 (compatible; MSIE 6.0; &quot;</span>\
                                <span class="s">&quot;Windows NT 5.1; SV1; .NET CLR 2.0.50727)&quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">POSTFIELDS</span><span class="p">,</span>  <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">FOLLOWLOCATION</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c">#c.setopt(pycurl.HEADER, 1)</span>
    <span class="c">#c.setopt(pycurl.CONNECTTIMEOUT, 0)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">MAXREDIRS</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c">#c.setopt(pycurl.COOKIEJAR, &quot;cookie.txt&quot;)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;html read error</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="py2exe-window">
<h3>3.9.2. py2exe window下打包发布<a class="headerlink" href="#py2exe-window" title="Permalink to this headline">¶</a></h3>
<p>一般情况下，只要把脚本，或pyc文件，或zip包(2.7后才支持)发布即可。但是，对于window，由于默认没有安装python环境，如果让普通用户都去安装一个
python环境，并设置一大堆环境，可能不是很方便，这时可以考虑用python发布模块。Python发布模块有很多种，这里只介绍较早使用的py2exe，它能把py脚本，
打包成exe和python运行所有的dll文件，用户直接执行exe就行了(缺点是打包的dll文件一般都较大，能有20几M)。</p>
<ul>
<li><p class="first">安装py2exe:</p>
<div class="highlight-python"><div class="highlight"><pre>easy_install py2exe
</pre></div>
</div>
</li>
<li><p class="first">完成主功能模块后，在功能模块对应的目录下，添加setup.py，并设置类似如下:</p>
</li>
</ul>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="kn">import</span> <span class="nn">py2exe</span>

<span class="n">includes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;encodings&quot;</span><span class="p">,</span> <span class="s">&quot;encodings.*&quot;</span><span class="p">]</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;py2exe&quot;</span><span class="p">:</span>
    <span class="p">{</span><span class="s">&quot;compressed&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s">&quot;optimize&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="s">&quot;ascii&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s">&quot;includes&quot;</span><span class="p">:</span><span class="n">includes</span><span class="p">,</span>
     <span class="s">&quot;bundle_files&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">setup</span><span class="p">(</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">,</span>
    <span class="n">zipfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>

    <span class="c"># The first three parameters are not required, if at least a</span>
    <span class="c"># &#39;version&#39; is given, then a versioninfo resource is built from</span>
    <span class="c"># them and added to the executables.</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s">&quot;0.1.0&quot;</span><span class="p">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;urlsign&quot;</span><span class="p">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;urlsign&quot;</span><span class="p">,</span>

    <span class="c"># targets to build</span>
    <span class="c"># windows = [&quot;test_wx.py&quot;],</span>
<span class="hll">    <span class="n">console</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;urlsign.py&quot;</span><span class="p">]</span>
</span><span class="c">#    console = [&quot;hello.py&quot;]</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<ul>
<li><p class="first">在该目录,执行如下命令打包:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py py2exe
</pre></div>
</div>
</li>
<li><p class="first">运行上面命令，全产生一个dist子目录，把该目录下的exe和一些dll文件发布即可。</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="chapter4.html" title="4. python常见应用"
             >next</a> |</li>
        <li class="right" >
          <a href="chapter2.html" title="2. python环境搭建"
             >previous</a> |</li>
        <li><a href="index.html">Python入门 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, 俞伟山.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>